<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Grand Hypno Generator — Ultimate Visuals</title>
<style>
:root{
  --bg:#070707;
  --panel:#0f0f10;
  --muted:#9aa0a6;
  --accent:#6aa6ff;
  --control:#121214;
  --border:#1e1e1f;
  --text:#e6e7e8;
  --danger:#ff7b6b;
}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--text)}
.wrap{max-width:1100px;margin:18px auto;padding:18px;background:linear-gradient(180deg,var(--panel),#070707);border-radius:12px;box-shadow:0 8px 40px rgba(0,0,0,0.7);border:1px solid var(--border)}
h1{margin:0 0 8px 0;font-size:20px}
.controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin:12px 0}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
select,input[type="number"],input[type="range"],button,a{padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:var(--control);color:var(--text);font-size:13px}
button.primary{background:linear-gradient(180deg,#1b1b1d,#141415);border:1px solid #242426;cursor:pointer}
button.ghost{background:transparent;border:1px dashed #222;color:var(--muted)}
button:disabled{opacity:0.45;cursor:not-allowed}
canvas{display:block;width:100%;height:auto;max-width:1280px;margin-top:12px;border-radius:10px;background:#000;border:1px solid #0b0b0b}
.row{display:flex;gap:10px;align-items:center}
.small{font-size:12px;color:var(--muted)}
.progress{height:10px;background:#0b0b0b;border-radius:6px;overflow:hidden;width:320px;margin-left:8px;border:1px solid #111}
.progress>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#39f);width:0%}
#downloadLink{margin-left:8px;display:none;text-decoration:none;border:1px solid var(--border);padding:8px 10px;border-radius:8px}
footer{margin-top:14px;color:var(--muted);font-size:12px}
.danger{color:var(--danger);font-weight:600}
.consent{display:flex;gap:10px;align-items:center;margin-top:8px}
.muted-note{font-size:12px;color:var(--muted);max-width:900px}
@media (max-width:720px){.controls{flex-direction:column;align-items:flex-start}}
#dummyVideo{position:absolute;width:1px;height:1px;opacity:0;pointer-events:none;}
</style>
</head>
<body>
<div class="wrap">
<h1>Grand Hypno Generator — Ultimate Visuals</h1>

<div class="controls">
  <div>
    <label for="mood">Mood / Effect</label>
    <select id="mood">
      <option value="calm">Calm / Soothing</option>
      <option value="energetic">Energetic / Uplifting</option>
      <option value="hungry">Appetite / Food-invoking</option>
      <option value="focus">Focus / Concentration</option>
      <option value="anxious">Tension / Alerting</option>
      <option value="dreamy">Dreamy / Trance</option>
    </select>
  </div>
  <div>
    <label for="pattern">Entraining Pattern</label>
    <select id="pattern">
      <option value="softBlobs">Soft Blobs</option>
      <option value="spiral">Spiral</option>
      <option value="figure8">Figure-8</option>
      <option value="pulse">Breathing Pulse</option>
      <option value="warmOrbs">Warm Orbitals</option>
      <!-- Mood-specific extra visual modes -->
      <option value="deepFlow">DeepFlow (Calm)</option>
      <option value="waveRipples">WaveRipples (Calm)</option>
      <option value="figure8Spiral">Figure8 Spiral (Focus)</option>
      <option value="concentricLines">Concentric Lines (Focus)</option>
      <option value="orbitOrbs">Orbiting Orbs (Hungry)</option>
      <option value="warmGlowDots">Warm Glow Dots (Hungry)</option>
      <option value="starBurst">StarBurst (Energetic)</option>
      <option value="flickerDots">Flicker Dots (Energetic)</option>
      <option value="floatingTriangles">Floating Triangles (Dreamy)</option>
      <option value="translucentWaves">Translucent Waves (Dreamy)</option>
      <option value="jitterPolygons">Jitter Polygons (Anxious)</option>
      <option value="shakyLines">Shaky Lines (Anxious)</option>
    </select>
  </div>
  <div>
    <label for="duration">Duration (sec) — max 3600</label>
    <input id="duration" type="number" min="1" max="3600" value="20"/>
  </div>
  <div>
    <label for="resolution">Resolution</label>
    <select id="resolution">
      <option value="1280x720">1280×720</option>
      <option value="960x540" selected>960×540</option>
      <option value="854x480">854×480</option>
      <option value="640x360">640×360</option>
    </select>
  </div>
  <div>
    <label for="fps">FPS</label>
    <input id="fps" type="number" min="12" max="60" value="30"/>
  </div>

  <div style="margin-left:auto;">
    <div class="row">
      <button id="startPreviewBtn" class="primary">Start Preview</button>
      <button id="stopPreviewBtn" class="ghost" disabled>Stop Preview</button>
      <button id="recordBtn" class="primary">Record</button>
      <button id="stopRecordBtn" class="ghost" disabled>Stop Recording</button>
      <a id="downloadLink">Download video</a>
    </div>
    <div class="row" style="margin-top:6px;">
      <div class="small">Status:</div>
      <div id="statusLabel" class="small" style="margin-left:8px;color:var(--muted)">preview stopped • not recording</div>
    </div>
  </div>
</div>

<div class="controls">
  <div class="row">
    <label class="small">Shape density</label>
    <input id="density" type="range" min="5" max="300" value="80"/>
  </div>
  <div class="row">
    <label class="small">Motion complexity</label>
    <input id="complexity" type="range" min="1" max="10" value="4"/>
  </div>
  <div class="row">
    <label class="small">Saturation</label>
    <input id="sat" type="range" min="0" max="200" value="100"/>
  </div>
  <div class="progress" title="Recording progress" style="margin-left:8px;">
    <i id="progressFill"></i>
  </div>
</div>

<div class="consent">
  <input id="consentBox" type="checkbox"/>
  <div>
    <div style="font-size:13px;color:var(--muted);">I confirm I have informed consent from participants for visual/audio entrainment and they are aware of potential effects (dizziness, nausea, headache, photosensitivity).</div>
    <div class="muted-note">To enable procedural audio or strong entrainment patterns you must check this box. Recording with audio is disabled until consent is given.</div>
  </div>
</div>

<div style="margin-top:10px;">
  <label class="small">Enable procedural audio — requires consent</label>
  <input id="enableAudio" type="checkbox"/>
  <label class="small" style="margin-left:12px">Audio Mode</label>
  <select id="audioMode">
    <option value="none">None</option>
    <option value="alpha">Alpha (8–12 Hz, calming, relaxed focus)</option>
    <option value="theta">Theta (4–8 Hz, deep relaxation, creativity)</option>
    <option value="beta">Beta (12–30 Hz, alert, problem-solving, slightly stress-inducing)</option>
    <option value="infrasound">Infrasound-like (17–19 Hz, unsettling, anxiety, dizziness)</option>
    <option value="appetite">Appetite ambient (warm bass pulses, subtly increases appetite)</option>
  </select>
</div>

<canvas id="stage" width="960" height="540"></canvas>
<video id="dummyVideo" playsinline muted></video>

<footer>
  <strong>Safety & ethics</strong> — Strong visual/audio entrainment. Must only be used with informed consent. Can affect mood, focus, and cause physical sensations. Stop immediately if anyone feels discomfort. <span class="danger">Do not use on children, pregnant people, or people with photosensitive epilepsy.</span>
</footer>

<script>
/* ------------------------------
Core DOM & state
------------------------------ */
const canvas=document.getElementById('stage');
const ctx=canvas.getContext('2d',{alpha:false});
let width=canvas.width,height=canvas.height;
const moodSelect=document.getElementById('mood');
const patternSelect=document.getElementById('pattern');
const startPreviewBtn=document.getElementById('startPreviewBtn');
const stopPreviewBtn=document.getElementById('stopPreviewBtn');
const recordBtn=document.getElementById('recordBtn');
const stopRecordBtn=document.getElementById('stopRecordBtn');
const downloadLink=document.getElementById('downloadLink');
const durationInput=document.getElementById('duration');
const resolutionInput=document.getElementById('resolution');
const fpsInput=document.getElementById('fps');
const densityInput=document.getElementById('density');
const complexityInput=document.getElementById('complexity');
const satInput=document.getElementById('sat');
const progressFill=document.getElementById('progressFill');
const statusLabel=document.getElementById('statusLabel');
const consentBox=document.getElementById('consentBox');
const enableAudio=document.getElementById('enableAudio');
const audioMode=document.getElementById('audioMode');
const dummyVideo=document.getElementById('dummyVideo');

let previewRunning=false,animationId=null,particles=[],mediaRecorder=null,recordedChunks=[],audioCtx=null,audioDestination=null,audioNodes=null;

/* ------------------------------
Mood presets & palettes
------------------------------ */
const moodPresets={
  calm:{palette:['#0B3D91','#144E8B','#1E6091','#1C3D70','#0F1F40']},
  energetic:{palette:['#FFD700','#FF4500','#FF6347','#FF8C00','#FFA500']},
  hungry:{palette:['#FF4500','#FF6347','#FFA07A','#FFD700']},
  focus:{palette:['#1E90FF','#00CED1','#20B2AA','#48D1CC']},
  anxious:{palette:['#D9534F','#FF6347','#B22222','#A52A2A']},
  dreamy:{palette:['#B39DDB','#CE93D8','#B3E5FC','#E1BEE7','#D1C4E9']}
};

/* ------------------------------
Canvas & particles
------------------------------ */
function resizeCanvasFor(resString){const [w,h]=resString.split('x').map(n=>parseInt(n,10));canvas.width=w;canvas.height=h;width=w;height=h;}
function initParticles(count=120,palette=['#fff'],pattern='softBlobs'){
  particles=[];
  for(let i=0;i<count;i++){
    let size=Math.random()*15+3;
    let angle=Math.random()*Math.PI*2;
    let seed=Math.random();
    let x=Math.random()*width,y=Math.random()*height;
    let shape='circle';
    switch(pattern){
      case 'softBlobs': shape='circle'; break;
      case 'spiral': shape='line'; break;
      case 'figure8': shape='line'; break;
      case 'pulse': shape='circle'; break;
      case 'warmOrbs': shape='circle'; break;
      case 'deepFlow': shape='blob'; break;
      case 'waveRipples': shape='wave'; break;
      case 'figure8Spiral': shape='line'; break;
      case 'concentricLines': shape='line'; break;
      case 'orbitOrbs': shape='circle'; break;
      case 'warmGlowDots': shape='circle'; break;
      case 'starBurst': shape='star'; break;
      case 'flickerDots': shape='circle'; break;
      case 'floatingTriangles': shape='triangle'; break;
      case 'translucentWaves': shape='wave'; break;
      case 'jitterPolygons': shape='polygon'; break;
      case 'shakyLines': shape='line'; break;
    }
    particles.push({x,y,size,angle,seed,color:palette[Math.floor(Math.random()*palette.length)],shape});
  }
}

/* ------------------------------
Shape Drawing
------------------------------ */
function drawParticle(p){
  ctx.save();
  ctx.translate(p.x,p.y);
  ctx.rotate(p.angle);
  ctx.globalAlpha=0.7+Math.sin(Date.now()/1000+p.seed)*0.3;
  switch(p.shape){
    case 'circle':
    case 'blob':
      ctx.beginPath(); ctx.fillStyle=p.color; ctx.arc(0,0,p.size,0,Math.PI*2); ctx.fill(); break;
    case 'triangle':
      ctx.beginPath();
      ctx.moveTo(0,-p.size); ctx.lineTo(p.size, p.size); ctx.lineTo(-p.size,p.size); ctx.closePath();
      ctx.fillStyle=p.color; ctx.fill(); break;
    case 'polygon':
      let sides=4+Math.floor(Math.random()*3); ctx.beginPath();
      for(let i=0;i<sides;i++){ctx.lineTo(p.size*Math.cos(i*2*Math.PI/sides),p.size*Math.sin(i*2*Math.PI/sides));}
      ctx.closePath(); ctx.fillStyle=p.color; ctx.fill(); break;
    case 'line':
      ctx.strokeStyle=p.color; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(-p.size,0); ctx.lineTo(p.size,0); ctx.stroke(); break;
    case 'star':
      ctx.beginPath();
      for(let i=0;i<5;i++){
        ctx.lineTo(p.size*Math.cos((i*2*Math.PI)/5),p.size*Math.sin((i*2*Math.PI)/5));
        ctx.lineTo((p.size/2)*Math.cos((i*2*Math.PI+Math.PI)/5),(p.size/2)*Math.sin((i*2*Math.PI+Math.PI)/5));
      }
      ctx.closePath(); ctx.fillStyle=p.color; ctx.fill(); break;
    case 'wave':
      ctx.beginPath(); ctx.strokeStyle=p.color; ctx.lineWidth=2;
      for(let i=0;i<p.size*2;i+=2){ctx.lineTo(i-Math.random()*p.size,Math.sin(Date.now()/500+p.seed*10+i/5)*p.size);}
      ctx.stroke(); break;
  }
  ctx.restore();
}

/* ------------------------------
Particle Update
------------------------------ */
function updateParticles(){
  const pattern=patternSelect.value;
  const complexity=complexityInput.value;
  const density=densityInput.value;
  while(particles.length<density){
    initParticles(1,moodPresets[moodSelect.value].palette,pattern);
  }
  particles.forEach(p=>{
    let speed=(Math.random()*0.5+0.2)*(complexity/5);
    switch(pattern){
      case 'spiral': case 'figure8': case 'figure8Spiral':
        p.angle+=0.02*speed; p.x+=Math.cos(p.angle)*speed*2; p.y+=Math.sin(p.angle)*speed*2; break;
      case 'pulse': case 'warmOrbs': case 'orbitOrbs': case 'warmGlowDots':
        p.angle+=0.01*speed; p.size=5+Math.sin(Date.now()/300+p.seed*Math.PI*2)*10; break;
      case 'deepFlow': case 'waveRipples': case 'translucentWaves':
        p.x+=Math.sin(Date.now()/1000+p.seed*10)*0.5; p.y+=Math.cos(Date.now()/1000+p.seed*10)*0.5; break;
      case 'starBurst': case 'flickerDots':
        p.size=5+Math.random()*15; break;
      case 'floatingTriangles':
        p.y-=0.2; if(p.y<-50) p.y=height+50; break;
      case 'jitterPolygons':
        p.x+=Math.random()*3-1.5; p.y+=Math.random()*3-1.5; break;
      case 'shakyLines':
        p.angle+=Math.random()*0.1-0.05; break;
  }});
}

/* ------------------------------
Draw Loop
------------------------------ */
function drawParticles(){ctx.clearRect(0,0,width,height);particles.forEach(drawParticle);}

/* ------------------------------
Preview & recording
------------------------------ */
function startPreview(){
  if(previewRunning) return;
  previewRunning=true;
  startPreviewBtn.disabled=true; stopPreviewBtn.disabled=false;
  resizeCanvasFor(resolutionInput.value);
  initParticles(densityInput.value,moodPresets[moodSelect.value].palette,patternSelect.value);
  statusLabel.textContent='preview running • not recording';
  function loop(){if(!previewRunning) return; updateParticles(); drawParticles(); animationId=requestAnimationFrame(loop);}
  loop(); if(enableAudio.checked && consentBox.checked) startAudio();
}

function stopPreview(){
  previewRunning=false;
  cancelAnimationFrame(animationId);
  startPreviewBtn.disabled=false; stopPreviewBtn.disabled=true;
  statusLabel.textContent='preview stopped • not recording';
  stopAudio();
}

/* ------------------------------
Recording
------------------------------ */
function startRecording(){
  if(!previewRunning){alert('Start preview first'); return;}
  const fps=fpsInput.value;
  const stream=canvas.captureStream(fps);
  if(enableAudio.checked && consentBox.checked && audioDestination){
    stream.addTrack(audioDestination.stream.getAudioTracks()[0]);
  }
  recordedChunks=[];
  mediaRecorder=new MediaRecorder(stream,{mimeType:'video/webm;codecs=vp9,opus'});
  mediaRecorder.ondataavailable=e=>{if(e.data.size>0) recordedChunks.push(e.data)};
  mediaRecorder.onstop=()=>{
    const blob=new Blob(recordedChunks,{type:'video/webm'});
    downloadLink.href=URL.createObjectURL(blob);
    downloadLink.style.display='inline-block';
    downloadLink.download='hypno_video.webm';
  };
  mediaRecorder.start();
  stopRecordBtn.disabled=false; recordBtn.disabled=true;
  statusLabel.textContent='preview running • recording';
  const maxDuration=parseInt(durationInput.value,10)*1000;
  setTimeout(()=>{if(mediaRecorder.state==='recording') stopRecording()},maxDuration);
}

function stopRecording(){
  if(mediaRecorder && mediaRecorder.state==='recording') mediaRecorder.stop();
  stopRecordBtn.disabled=true; recordBtn.disabled=false;
  statusLabel.textContent='preview running • not recording';
  progressFill.style.width='100%';
}

/* ------------------------------
Audio
------------------------------ */
function startAudio(){
  if(audioCtx) return;
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  audioDestination=audioCtx.createMediaStreamDestination();
  audioNodes={};
  const mode=audioMode.value;
  if(mode==='none') return;
  let baseFreq=10;
  switch(mode){case'infrasound':baseFreq=18;break;case'alpha':baseFreq=10;break;case'theta':baseFreq=6;break;case'beta':baseFreq=16;break;}
  if(['infrasound','alpha','theta','beta'].includes(mode)){
    let osc=audioCtx.createOscillator();
    osc.type='sine'; osc.frequency.value=baseFreq;
    let gainNode=audioCtx.createGain(); gainNode.gain.value=0.02;
    osc.connect(gainNode).connect(audioDestination);
    osc.start(); audioNodes.oscillator=osc;
  }
  if(mode==='appetite'){let osc1=audioCtx.createOscillator(); osc1.type='sine'; osc1.frequency.value=220;
    let gain1=audioCtx.createGain(); gain1.gain.value=0.01; osc1.connect(gain1).connect(audioDestination); osc1.start();}
  if(dummyVideo.paused) dummyVideo.play();
}
function stopAudio(){if(audioCtx){audioCtx.close();audioCtx=null; audioNodes=null;} dummyVideo.pause();}

/* ------------------------------
Event listeners
------------------------------ */
startPreviewBtn.addEventListener('click',()=>{if(consentBox.checked) startPreview(); else alert('Check consent box first')});
stopPreviewBtn.addEventListener('click',stopPreview);
recordBtn.addEventListener('click',startRecording);
stopRecordBtn.addEventListener('click',stopRecording);
resolutionInput.addEventListener('change',()=>resizeCanvasFor(resolutionInput.value));
</script>
</body>
</html>
